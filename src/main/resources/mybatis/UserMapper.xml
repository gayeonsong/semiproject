<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.UserMapper">

    <!-- 1. 회원 등록 -->
    <insert id="insert" parameterType="UserDTO" useGeneratedKeys="true" keyProperty="userId">
       <selectKey keyProperty="userId" resultType="int" order="BEFORE">
           select seq_login.nextval from dual
       </selectKey>
        INSERT INTO login (user_id,login_id, password, role)
        VALUES (#{userId},#{loginId}, #{password}, #{role})
    </insert>


    <!-- 2. 로그인 체크 -->
    <select id="loginCheckByLoginId" parameterType="String" resultType="UserDTO">
        SELECT user_id AS userId, login_id AS loginId, password, role
        FROM login
        WHERE login_id = #{loginId} <!-- 여기서 #{loginId}는 string 파라미터 자체 -->

    </select>

    <!-- 3. 검색 조건 -->
    <sql id="search">
        <where>
            <if test= "keyword != null and keyword != ''and filed == 'login_id' ">
                  AND login_id LIKE '%' || #{keyword} || '%'
                    </if>
                    <if test = "role != null">
                        AND role = #{role}  <!-- role 검색 (별도 int 파라미터로 받기) -->
            </if>
        </where>
    </sql>

<!--    &lt;!&ndash; 4. 사용자 목록 (페이징) &ndash;&gt;-->
<!--    <select id="getUserList" parameterType="map" resultType="UserDTO">-->
<!--        SELECT *-->
<!--        FROM (-->
<!--        SELECT m.*, ROW_NUMBER() OVER (ORDER BY user_id DESC) AS rnum-->
<!--        FROM login m-->
<!--        <include refid="search"/>-->
<!--        ) ranked-->
<!--        WHERE rnum BETWEEN #{startRow} AND #{endRow}-->
<!--    </select>-->

<!--    &lt;!&ndash; 5. 전체 수 &ndash;&gt;-->
<!--    <select id="count" parameterType="map" resultType="int">-->
<!--        SELECT NVL(COUNT(*), 0)-->
<!--        FROM login-->
<!--        <include refid="search"/>-->
<!--    </select>-->

<!--    &lt;!&ndash; 6. 상세 조회 &ndash;&gt;-->
<!--    <select id="detail" parameterType="int" resultType="UserDTO">-->
<!--        SELECT user_id, login_id, password, role-->
<!--        FROM login-->
<!--        WHERE user_id = #{userId}-->
<!--    </select>-->

</mapper>